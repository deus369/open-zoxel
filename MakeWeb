# Zoxel Makefile! for Web
# Error 127 - do this
# 	source ~/emsdk/emsdk_env.sh
# Build ~
#	make -j24 -B -f MakeWeb
# Run !
#	emrun --browser firefox web-demo/index.html
# All
#	source ~/emsdk/emsdk_env.sh; make -j24 -B -f MakeWeb; emrun --browser firefox web-demo/index.html


# remember to go to tools > console > multiprocess to get all errors
# install emcc https://emscripten.org/docs/getting_started/downloads.html#installation-instructions-using-the-emsdk-recommended
#zoxel.html:1237:21

# Declare compiler tools and flags
CC = emcc  					# Defines the compiler, cc for C code
CFLAGS = -std=c99			# Specificies c99 StandardX
CFLAGS += --preload-file Resources
# what does this do!
CFLAGS += -s WASM=1
# Optimize - Non Devv Build
CFLAGS += -O3
# Add libraries
CFLAGS += -lGL
CFLAGS += -lSDL
CFLAGS += -s USE_SDL=2
CFLAGS += -s USE_SDL_IMAGE=2
CFLAGS += -s SDL2_IMAGE_FORMATS='["png"]' # "bmp",
CFLAGS += -s FULL_ES3=1
CFLAGS += -s USE_WEBGL2=1
CFLAGS += -s MIN_WEBGL_VERSION=2
CFLAGS += -s MAX_WEBGL_VERSION=2
CFLAGS += -s ALLOW_MEMORY_GROWTH
# Threadin
# LDLIBS += -s USE_PTHREADS=1
# LDLIBS += -s PTHREAD_POOL_SIZE=2
LDLIBS = 

# Debug Info
# LDLIBS += -s ASSERTIONS
# Link Time Optimization
# LDLIBS += -flto
# dev
# LDLIBS += --profiling
# unsafe
# LDLIBS += --closure 1
# profilers
#--cpuprofiler
#--memoryprofiler
# LDLIBS += --threadprofiler

# OBJS defines all the files used to compile Zoxel.
OBJS =
OBJS += Imports/Flecs/flecs.c
OBJS += Source/main.c

# SRCS defines all the files that will be used in the game.
SRCS = 
SRCS += Imports/Flecs/flecs.c 
SRCS += Imports/Flecs/flecs.h
SRCS += Source/main.c
# Imports
# SRCS += Imports/SDL/SDLUtil.c
SRCS += Source/Core/App/Util/FlecsUtil.c
# Gameplay
# Characters2D
SRCS += Source/Gameplay/Characters2D/Characters2D.c
SRCS += Source/Gameplay/Characters2D/Systems/BobSpawnSystem.c
# Players
SRCS += Source/Space/Players/Players.c
SRCS += Source/Space/Players/Systems/Player2DMoveSystem.c
# Rendering
SRCS += Source/Core/Rendering/Rendering.c
SRCS += Source/Core/Rendering/Core/RenderingCore.c

# SRCS += Resources/Shaders/BasicRender2D.vert
# SRCS += Resources/Shaders/BasicRender2D.frag

web-demo/zoxel.js: $(SRCS)
	$(CC) $(CFLAGS) -o $@ $(OBJS) $(LDLIBS)


# LDLIBS += -s FULL_ES2
# LDLIBS += -s OFFSCREEN_FRAMEBUFFER=1
# LDLIBS += -s LEGACY_GL_EMULATION=1
# LDLIBS += -s GL_UNSAFE_OPTS=1
# LDLIBS += -s ERROR_ON_UNDEFINED_SYMBOLS=0
# LDLIBS += -s ALLOW_MEMORY_GROWTH=1
# LDLIBS += -EMCC_DEBUG=1
# LDLIBS += -s GL_DEBUG=1
# LDLIBS += --preload-file Resources/Shaders/BasicRender2D.vert
# LDLIBS += --preload-file Resources/Shaders/BasicRender2D.frag
# Optimize
# -O3